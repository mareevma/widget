# План переработки под ТЗ (исполняемый)

## Цель
Переделать конфигуратор и админку под `тз.txt` так, чтобы не было хардкода материалов под конкретные типы товаров. Любой новый тип товара и материал должны добавляться через админку без доработки кода.

## Базовый принцип
- `Категория` (тип товара) и `Материал` живут отдельно.
- Связь доступности задается через `category_materials`.
- Виджет показывает только разрешенные связи.
- Админка дает быстрый интерфейс массовой настройки.

## Этапы

### 1. Админка: управление структурой (выполняется)
- [x] Перенести `Товары: структура` в меню после `Фасонов` и `Материалов`.
- [x] Добавить массовые действия: выбрать все/очистить.
- [x] Добавить счетчики выбранных сущностей.
- [x] Добавить поиск по фасонам и материалам.
- [x] Добавить копирование структуры из другой категории.
- [ ] Добавить отображение “где используется материал” на странице материалов.

### 2. Модель данных и ограничения
- [x] Проверить таблицы связей и уникальные индексы (`category_fits`, `category_materials`).
- [ ] Добавить миграцию для привязки палитры к материалам (если включаем этот режим).
- [ ] Добавить проверку целостности для каскадных удалений и конфликтов.

### 3. Конфигуратор: логика шагов и валидность опций
- [x] Мобильный пошаговый режим и прогресс.
- [x] Исправления мобильной верстки цветов и нанесений.
- [ ] Поддержка палитры на уровне материала (если нужно по ТЗ).
- [ ] Явные fallback-сообщения при пустых опциях.

### 4. Кастомизации из ТЗ
- [ ] Добавить сущность кастомизаций (варка, дистресс, лейблы, упаковка).
- [ ] Добавить управление в админке.
- [ ] Добавить шаг(и) в конфигуратор.
- [ ] Подключить влияние на цену.

### 5. Тесты, QA и релиз
- [ ] Расширить тесты на сценарий “новый товар + новый материал без кода”.
- [ ] Проверить мобильные экраны и скроллы.
- [ ] Проверить создание заявок с полным набором конфигураций.
- [ ] Выпустить релиз-кандидат и пройти чеклист.

## Ближайшие действия
1. Закончить UX страницы `Товары: структура` (что уже начато в этом цикле).
2. Подготовить миграции под палитру по материалам.
3. Обновить виджет на загрузку палитры по выбранному материалу.
